<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Mantenimientos
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Mantenimientos</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-list>
    @for (maintenance of maintenances; track maintenance.id) {
      <ion-item-sliding>
        <ion-item>
          <ion-label>
            <h2>{{ maintenance.type }}</h2>
            <p>{{ getVehicleName(maintenance.vehicleId) }}</p>
            <p>Fecha: {{ formatDate(maintenance.date) }}</p>
            <p>Kilometraje: {{ maintenance.mileage.toLocaleString() }} km</p>
            @if (maintenance.cost) {
              <p>Costo: ${{ maintenance.cost.toLocaleString() }}</p>
            }
          </ion-label>
        </ion-item>
        <!-- Botón Editar en cada mantenimiento -->
        <ion-item-options side="end">
          <ion-item-option color="primary" (click)="openEditMaintenance(maintenance)">Editar</ion-item-option>
          <ion-item-option color="danger" (click)="deleteMaintenance(maintenance.id!)">Eliminar</ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
    }
    @empty {
      <ion-item>
        <ion-label class="ion-text-center">
          No hay mantenimientos registrados. Agrega uno nuevo con el botón +
        </ion-label>
      </ion-item>
    }
  </ion-list>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="openModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <ion-modal [isOpen]="isModalOpen">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Nuevo Mantenimiento</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeModal()">Cancelar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-item>
          <ion-label position="stacked">Vehículo</ion-label>
          <ion-select [(ngModel)]="newMaintenance.vehicleId">
            @for (vehicle of vehicles; track vehicle.id) {
              <ion-select-option [value]="vehicle.id">{{ vehicle.brand }} {{ vehicle.model }}</ion-select-option>
            }
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Tipo de Mantenimiento</ion-label>
          <ion-select [(ngModel)]="newMaintenance.type">
            @for (type of maintenanceTypes; track type) {
              <ion-select-option [value]="type">{{ type }}</ion-select-option>
            }
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Fecha</ion-label>
          <ion-input type="date" [(ngModel)]="newMaintenance.date"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Kilometraje</ion-label>
          <ion-input type="number" [(ngModel)]="newMaintenance.mileage" placeholder="Ej. 15000"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Costo ($)</ion-label>
          <ion-input type="number" [(ngModel)]="newMaintenance.cost" placeholder="Ej. 1500"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Notas</ion-label>
          <ion-textarea [(ngModel)]="newMaintenance.notes" placeholder="Detalles adicionales..."></ion-textarea>
        </ion-item>
        <div class="ion-padding">
          <ion-button expand="block" (click)="saveMaintenance()">Guardar</ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Modal para editar mantenimiento -->
  <ion-modal [isOpen]="isEditModalOpen">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Editar Mantenimiento</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeEditMaintenance()">Cancelar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-item>
          <ion-label position="stacked">Vehículo</ion-label>
          <ion-select [(ngModel)]="editMaintenance!.vehicleId">
            @for (vehicle of vehicles; track vehicle.id) {
              <ion-select-option [value]="vehicle.id">{{ vehicle.brand }} {{ vehicle.model }}</ion-select-option>
            }
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Tipo de Mantenimiento</ion-label>
          <ion-select [(ngModel)]="editMaintenance!.type">
            @for (type of maintenanceTypes; track type) {
              <ion-select-option [value]="type">{{ type }}</ion-select-option>
            }
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Fecha</ion-label>
          <ion-input type="date" [(ngModel)]="editMaintenance!.date"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Kilometraje</ion-label>
          <ion-input type="number" [(ngModel)]="editMaintenance!.mileage"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Costo ($)</ion-label>
          <ion-input type="number" [(ngModel)]="editMaintenance!.cost"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Notas</ion-label>
          <ion-textarea [(ngModel)]="editMaintenance!.notes"></ion-textarea>
        </ion-item>
        <div class="ion-padding">
          <ion-button expand="block" (click)="saveEditMaintenance()">Guardar</ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
