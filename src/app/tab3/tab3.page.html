<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Recordatorios
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Recordatorios</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-list>
    @for (reminder of reminders; track reminder.id) {
      <ion-item-sliding>
        <ion-item>
          <ion-icon 
            [name]="'alert-circle'" 
            slot="start" 
            [color]="getStatusColor(getDaysRemaining(reminder.dueDate))">
          </ion-icon>
          <ion-label>
            <h2>{{ reminder.maintenanceType }}</h2>
            <p>{{ getVehicleName(reminder.vehicleId) }}</p>
            <p>Próximo: {{ formatDate(reminder.dueDate) }}</p>
            @if (reminder.mileage) {
              <p>Kilometraje sugerido: {{ reminder.mileage.toLocaleString() }} km</p>
            }
            @if (getDaysRemaining(reminder.dueDate) > 0) {
              <p>Faltan: {{ getDaysRemaining(reminder.dueDate) }} días</p>
            } @else if (getDaysRemaining(reminder.dueDate) === 0) {
              <p><strong>¡Hoy es el día!</strong></p>
            } @else {
              <p><strong>¡Atrasado por {{ -getDaysRemaining(reminder.dueDate) }} días!</strong></p>
            }
          </ion-label>
        </ion-item>
        <ion-item-options side="end">
          <ion-item-option color="primary" (click)="openEdit(reminder)">Editar</ion-item-option>
          <ion-item-option color="success" (click)="markAsCompleted(reminder)">Completado</ion-item-option>
          <ion-item-option color="danger" (click)="deleteReminder(reminder.id!)">Eliminar</ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
    }
    @empty {
      <ion-item>
        <ion-label class="ion-text-center">
          No hay recordatorios activos. Se crearán automáticamente al registrar mantenimientos.
        </ion-label>
      </ion-item>
    }
  </ion-list>

  <ion-modal [isOpen]="isEditModalOpen" (didDismiss)="closeEdit()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Editar recordatorio</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-item>
          <ion-label position="stacked">Tipo de mantenimiento</ion-label>
          <ion-input [(ngModel)]="editMaintenanceType"></ion-input>
        </ion-item>
  
        <ion-item>
          <ion-label position="stacked">Fecha</ion-label>
          <ion-datetime presentation="date" [(ngModel)]="editDueDate"></ion-datetime>
        </ion-item>
  
        <ion-item>
          <ion-label position="stacked">Kilometraje</ion-label>
          <ion-input type="number" [(ngModel)]="editMileage"></ion-input>
        </ion-item>
  
        <div class="ion-padding-top">
          <ion-button expand="block" color="medium" (click)="closeEdit()">Cancelar</ion-button>
          <ion-button expand="block" color="primary" (click)="saveEdit()">Guardar</ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
